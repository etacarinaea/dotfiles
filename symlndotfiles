#!/bin/bash
#
# Creates symbolic links for dotfiles.
# Files in this directory may not have a dot prefix.

# List of files and directories to ignore, including this script.
# This will not delete existing symlinks!
ignore=(
${0##*/}
*.git/*
*.swp*
)

files=$(find $PWD -type f)

for file in $files; do
    dir=${file%/*}
    dir=${dir#*$PWD}
    dir=${dir#*/}

    for ex in ${ignore[@]}; do
        [[ ${file#*$PWD/} == $ex ]] && ig=true && break || ig=false 
    done
    [[ $ig = true ]] && continue

    file=${file##*/}
    if [[ $dir = "" ]]; then
        path=$HOME/$file
    else
        dir=$dir/
        path=$HOME/$dir$file
    fi

    echo "Creating Symlink to $dir$file at $path"
    [[ $1 = "-f" ]] && ln -sf "$PWD/$dir$file" "$path" || ln -s "$PWD/$dir$file" "$path"
    
    # just to be safe
    if [[ $? > "0"  ]] && [[ ! $1 = "-f" ]]; then
        read -p "Use force? [Y/N]: " uforce
        case $uforce in
            [Yy]* ) ln -sf "$PWD/$dir$file" "$path" && echo Done;;
            [Nn]* ) echo "Skipping.." && continue;;
        esac
    fi
done

